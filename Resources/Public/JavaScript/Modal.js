/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __values=this&&this.__values||function(a){var b="function"==typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){return a&&c>=a.length&&(a=void 0),{value:a&&a[c++],done:!a}}}};define(["require","exports","./Enum/Severity","jquery","./Icons","./Severity","bootstrap"],function(a,b,c,d,e,f){"use strict";var g;!function(a){a.modal=".t3js-modal",a.content=".t3js-modal-content",a.title=".t3js-modal-title",a.close=".t3js-modal-close",a.body=".t3js-modal-body",a.footer=".t3js-modal-footer",a.iframe=".t3js-modal-iframe",a.iconPlaceholder=".t3js-modal-icon-placeholder"}(g||(g={}));var h;!function(a){a.small="small",a.default="default",a.medium="medium",a.large="large",a.full="full"}(h||(h={}));var i;!function(a){a.default="default",a.light="light",a.dark="dark"}(i||(i={}));var j;!function(a){a.default="default",a.ajax="ajax",a.iframe="iframe"}(j||(j={}));var k=function(){function a(){this.sizes=h,this.styles=i,this.types=j,this.currentModal=null,this.instances=[],this.$template=d('<div class="t3js-modal modal fade"><div class="modal-dialog"><div class="t3js-modal-content modal-content"><div class="modal-header"><button class="t3js-modal-close close"><span aria-hidden="true"><span class="t3js-modal-icon-placeholder" data-icon="actions-close"></span></span><span class="sr-only"></span></button><h4 class="t3js-modal-title modal-title"></h4></div><div class="t3js-modal-body modal-body"></div><div class="t3js-modal-footer modal-footer"></div></div></div></div>'),this.defaultConfiguration={type:j.default,title:"Information",content:"No content provided, please check your <code>Modal</code> configuration.",severity:c.SeverityEnum.notice,buttons:[],style:i.default,size:h.default,additionalCssClasses:[],callback:d.noop(),ajaxCallback:d.noop(),ajaxTarget:null},d(document).on("modal-dismiss",this.dismiss),this.initializeMarkupTrigger(document)}return a.prototype.dismiss=function(){this.currentModal&&this.currentModal.modal("hide")},a.prototype.confirm=function(a,b,e,g,h){return void 0===e&&(e=c.SeverityEnum.warning),void 0===g&&(g=[]),0===g.length&&g.push({text:d(this).data("button-close-text")||TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel"},{text:d(this).data("button-ok-text")||TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+f.getCssClass(e),name:"ok"}),this.advanced({title:a,content:b,severity:e,buttons:g,additionalCssClasses:h,callback:function(a){a.on("button.clicked",function(a){"cancel"===a.target.getAttribute("name")?d(a.currentTarget).trigger("confirm.button.cancel"):"ok"===a.target.getAttribute("name")&&d(a.currentTarget).trigger("confirm.button.ok")})}})},a.prototype.loadUrl=function(a,b,d,e,f,g){return void 0===b&&(b=c.SeverityEnum.info),this.advanced({type:j.ajax,title:a,severity:b,buttons:d,ajaxCallback:f,ajaxTarget:g})},a.prototype.show=function(a,b,d,e,f){return void 0===d&&(d=c.SeverityEnum.info),this.advanced({type:j.default,title:a,content:b,buttons:e,additionalCssClasses:f})},a.prototype.advanced=function(a){return a.type="string"==typeof a.type&&a.type in j?a.type:this.defaultConfiguration.type,a.title="string"==typeof a.title?a.title:this.defaultConfiguration.title,a.content="string"==typeof a.content||"object"==typeof a.content?a.content:this.defaultConfiguration.content,a.severity="undefined"!=typeof a.severity?a.severity:this.defaultConfiguration.severity,a.buttons=a.buttons||this.defaultConfiguration.buttons,a.size="string"==typeof a.size&&a.size in h?a.size:this.defaultConfiguration.size,a.style="string"==typeof a.style&&a.style in i?a.style:this.defaultConfiguration.style,a.additionalCssClasses=a.additionalCssClasses||this.defaultConfiguration.additionalCssClasses,a.callback="function"==typeof a.callback?a.callback:this.defaultConfiguration.callback,a.ajaxCallback="function"==typeof a.ajaxCallback?a.ajaxCallback:this.defaultConfiguration.ajaxCallback,a.ajaxTarget="string"==typeof a.ajaxTarget?a.ajaxTarget:this.defaultConfiguration.ajaxTarget,this.generate(a)},a.prototype.initializeMarkupTrigger=function(a){var b=this;d(a).on("click",".t3js-modal-trigger",function(a){a.preventDefault();var e=d(a.currentTarget),g=e.data("content")||"Are you sure?",h="undefined"!=typeof c.SeverityEnum[e.data("severity")]?c.SeverityEnum[e.data("severity")]:c.SeverityEnum.info,i=e.data("url")||null;if(null!==i){var k=i.indexOf("?")>-1?"&":"?",l=d.param({data:e.data()});i=i+k+l}b.advanced({type:null!==i?j.ajax:j.default,title:e.data("title")||"Alert",content:null!==i?i:g,severity:h,buttons:[{text:e.data("button-close-text")||"Close",active:!0,btnClass:"btn-default",trigger:function(){b.currentModal.trigger("modal-dismiss")}},{text:e.data("button-ok-text")||"OK",btnClass:"btn-"+f.getCssClass(h),trigger:function(){b.currentModal.trigger("modal-dismiss"),a.target.ownerDocument.location.href=e.data("href")||e.attr("href")}}]})})},a.prototype.generate=function(a){var b=this,c=this.$template.clone();if(a.additionalCssClasses.length>0)try{for(var h=__values(a.additionalCssClasses),i=h.next();!i.done;i=h.next()){var j=i.value;c.addClass(j)}}catch(a){m={error:a}}finally{try{i&&!i.done&&(n=h.return)&&n.call(h)}finally{if(m)throw m.error}}if(c.addClass("modal-type-"+a.type),c.addClass("modal-severity-"+f.getCssClass(a.severity)),c.addClass("modal-style-"+a.style),c.addClass("modal-size-"+a.size),c.attr("tabindex","-1"),c.find(g.title).text(a.title),c.find(g.close).on("click",function(){c.modal("hide")}),"ajax"===a.type?(d.get(a.content,function(c){b.currentModal.find(a.ajaxTarget?a.ajaxTarget:g.body).empty().append(c),a.ajaxCallback&&a.ajaxCallback(),b.currentModal.trigger("modal-loaded")},"html"),e.getIcon("spinner-circle",e.sizes.default,null,null,e.markupIdentifiers.inline).done(function(a){c.find(g.body).html('<div class="modal-loading">'+a+"</div>")})):"iframe"===a.type?(c.find(g.body).append(d("<iframe />",{src:a.content,name:"modal_frame",class:"modal-iframe t3js-modal-iframe"})),c.find(g.iframe).on("load",function(){c.find(g.title).text(c.find(g.iframe).get(0).contentDocument.title)})):("string"==typeof a.content&&(/^<[a-z][\s\S]*>/i.test(a.content)||(a.content=d("<p />").html(a.content))),c.find(g.body).append(a.content)),a.buttons.length>0){for(var k=function(b){var e=a.buttons[b],f=d("<button />",{class:"btn"});f.html("<span>"+e.text+"</span>"),e.active&&f.addClass("t3js-active"),""!==e.btnClass&&f.addClass(e.btnClass),""!==e.name&&f.attr("name",e.name),e.trigger&&f.on("click",e.trigger),e.dataAttributes&&Object.keys(e.dataAttributes).length>0&&Object.keys(e.dataAttributes).map(function(a){f.attr("data-"+a,e.dataAttributes[a])}),e.icon&&f.prepend('<span class="t3js-modal-icon-placeholder" data-icon="'+e.icon+'"></span>'),c.find(g.footer).append(f)},l=0;l<a.buttons.length;l++)k(l);c.find(g.footer).find("button").on("click",function(a){d(a.currentTarget).trigger("button.clicked")})}else c.find(g.footer).remove();return c.on("shown.bs.modal",function(a){var c=d(a.currentTarget);c.find(g.footer).find(".t3js-active").first().focus(),c.find(g.iconPlaceholder).each(function(a,c){e.getIcon(d(c).data("icon"),e.sizes.small,null,null,e.markupIdentifiers.inline).done(function(a){b.currentModal.find(g.iconPlaceholder+"[data-icon="+d(a).data("identifier")+"]").replaceWith(a)})})}),c.on("hidden.bs.modal",function(){if(b.instances.length>0){var a=b.instances.length-1;b.instances.splice(a,1),b.currentModal=b.instances[a-1]}c.trigger("modal-destroyed"),d(b).remove(),b.instances.length>0&&d("body").addClass("modal-open")}),c.on("show.bs.modal",function(a){b.currentModal=d(a.currentTarget),b.instances.push(b.currentModal)}),c.on("modal-dismiss",function(a){d(a.currentTarget).modal("hide")}),a.callback&&a.callback(c),c.modal();var m,n},a}(),l=null;try{parent&&parent.window.TYPO3&&parent.window.TYPO3.Modal?(parent.window.TYPO3.Modal.initializeMarkupTrigger(document),l=parent.window.TYPO3.Modal):top&&top.TYPO3.Modal&&(top.TYPO3.Modal.initializeMarkupTrigger(document),l=top.TYPO3.Modal)}catch(a){}return l||(l=new k,TYPO3.Modal=l),l});