/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function c(e){try{a(n.next(e))}catch(e){s(e)}}function o(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(c,o)}a((n=n.apply(e,t||[])).next())}))};define(["require","exports","TYPO3/CMS/Core/Ajax/AjaxRequest","./Storage/Client"],(function(e,t,i,n){"use strict";var r,s,c;!function(e){e.small="small",e.default="default",e.large="large",e.overlay="overlay"}(r||(r={})),function(e){e.default="default",e.disabled="disabled"}(s||(s={})),function(e){e.default="default",e.inline="inline"}(c||(c={}));class o{constructor(){this.sizes=r,this.states=s,this.markupIdentifiers=c,this.promiseCache={}}getIcon(e,t,i,o,a){const h=[e,t=t||r.default,i,o=o||s.default,a=a||c.default],u=h.join("_");return this.getIconRegistryCache().then(e=>(n.isset("icon_registry_cache_identifier")&&n.get("icon_registry_cache_identifier")===e||(n.unsetByPrefix("icon_"),n.set("icon_registry_cache_identifier",e)),this.fetchFromLocal(u).then(null,()=>this.fetchFromRemote(h,u))))}getIconRegistryCache(){return this.isPromiseCached("icon_registry_cache_identifier")||this.putInPromiseCache("icon_registry_cache_identifier",new i(TYPO3.settings.ajaxUrls.icons_cache).get().then(e=>__awaiter(this,void 0,void 0,(function*(){return yield e.resolve()})))),this.getFromPromiseCache("icon_registry_cache_identifier")}fetchFromRemote(e,t){if(!this.isPromiseCached(t)){const r={icon:JSON.stringify(e)};this.putInPromiseCache(t,new i(TYPO3.settings.ajaxUrls.icons).withQueryArguments(r).get().then(e=>__awaiter(this,void 0,void 0,(function*(){const i=yield e.resolve();return i.includes("t3js-icon")&&i.includes('<span class="icon-markup">')&&n.set("icon_"+t,i),i}))))}return this.getFromPromiseCache(t)}fetchFromLocal(e){return n.isset("icon_"+e)?Promise.resolve(n.get("icon_"+e)):Promise.reject()}isPromiseCached(e){return void 0!==this.promiseCache[e]}getFromPromiseCache(e){return this.promiseCache[e]}putInPromiseCache(e,t){this.promiseCache[e]=t}}let a;return a||(a=new o,TYPO3.Icons=a),a}));