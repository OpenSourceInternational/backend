/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","./Enum/KeyTypes","jquery","./Storage/Persistent","./Wizard/NewContentElement"],function(a,b,c,d,e,f){"use strict";var g;!function(a){a.pageTitle=".t3js-title-inlineedit",a.hiddenElements=".t3js-hidden-record",a.newButton=".t3js-toggle-new-content-element-wizard"}(g||(g={}));var h=function(){function b(){var a=this;this.pageId=0,this.pageOverlayId=0,this.$pageTitle=null,this.$showHiddenElementsCheckbox=null,d(function(){a.initializeElements(),a.initializeEvents(),a.initializeNewContentElementWizard(),a.initializePageTitleRenaming()})}return b.prototype.setPageId=function(a){this.pageId=a},b.prototype.setLanguageOverlayId=function(a){this.pageOverlayId=a},b.prototype.initializePageTitleRenaming=function(){var a=this;if(!d.isReady)return void d(function(){a.initializePageTitleRenaming()});if(!(this.pageId<=0)){var b=d('<a class="hidden" href="#" data-action="edit"><span class="t3-icon fa fa-pencil"></span></a>');b.on("click",function(b){b.preventDefault(),a.editPageTitle()}),this.$pageTitle.on("dblclick",function(){a.editPageTitle()}).on("mouseover",function(){b.removeClass("hidden")}).on("mouseout",function(){b.addClass("hidden")}).append(b)}},b.prototype.initializeElements=function(){this.$pageTitle=d(g.pageTitle+":first"),this.$showHiddenElementsCheckbox=d("#checkTt_content_showHidden")},b.prototype.initializeEvents=function(){this.$showHiddenElementsCheckbox.on("change",this.toggleContentElementVisibility)},b.prototype.toggleContentElementVisibility=function(a){var b=d(a.currentTarget),c=d(g.hiddenElements),f=d("<span />",{class:"checkbox-spinner fa fa-circle-o-notch fa-spin"});b.hide().after(f),b.prop("checked")?c.slideDown():c.slideUp(),e.set("moduleData.web_layout.tt_content_showHidden",String(b.prop("checked"))).done(function(){f.remove(),b.show()})},b.prototype.editPageTitle=function(){var a=this,b=d('<form><div class="form-group"><div class="input-group input-group-lg"><input class="form-control"><span class="input-group-btn"><button class="btn btn-default" type="button" data-action="submit"><span class="t3-icon fa fa-floppy-o"></span></button> </span><span class="input-group-btn"><button class="btn btn-default" type="button" data-action="cancel"><span class="t3-icon fa fa-times"></span></button> </span></div></div></form>'),e=b.find("input");b.find("[data-action=cancel]").on("click",function(){b.replaceWith(a.$pageTitle),a.initializePageTitleRenaming()}),b.find("[data-action=submit]").on("click",function(){var c=d.trim(e.val());""!==c&&a.$pageTitle.text()!==c?a.saveChanges(e):b.find("[data-action=cancel]").trigger("click")}),e.parents("form").on("submit",function(a){return a.preventDefault(),!1});var f=this.$pageTitle;f.children().last().remove(),f.replaceWith(b),e.val(f.text()).focus(),e.on("keyup",function(a){switch(a.which){case c.KeyTypesEnum.ENTER:b.find('[data-action="submit"]').trigger("click");break;case c.KeyTypesEnum.ESCAPE:b.find('[data-action="cancel"]').trigger("click")}})},b.prototype.saveChanges=function(b){var c=this,d=b.parents("form");d.find("button").addClass("disabled"),b.attr("disabled","disabled");var e,f={};e=this.pageOverlayId>0?this.pageOverlayId:this.pageId,f.data={},f.data.pages={},f.data.pages[e]={title:b.val()},a(["TYPO3/CMS/Backend/AjaxDataHandler"],function(a){a.process(f).done(function(){d.find("[data-action=cancel]").trigger("click"),c.$pageTitle.text(b.val()),c.initializePageTitleRenaming(),top.TYPO3.Backend.NavigationContainer.PageTree.refreshTree()}).fail(function(){d.find("[data-action=cancel]").trigger("click")})})},b.prototype.initializeNewContentElementWizard=function(){d(g.newButton).click(function(a){var b=d(a.currentTarget);f.wizard(b.data("url"),b.data("title"))})},b}();return new h});