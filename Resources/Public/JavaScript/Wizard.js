/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","./Enum/Severity","jquery","./Modal","./Severity","./Icons"],function(e,t,s,i,r,n,a){"use strict";var o,l=function(){function e(){this.setup={slides:[],settings:{},forceSelection:!0,$carousel:null},this.originalSetup=i.extend(!0,{},this.setup)}return e.prototype.set=function(e,t){return this.setup.settings[e]=t,this},e.prototype.addSlide=function(e,t,i,r,n){void 0===i&&(i=""),void 0===r&&(r=s.SeverityEnum.info);var a={identifier:e,title:t,content:i,severity:r,callback:n};return this.setup.slides.push(a),this},e.prototype.addFinalProcessingSlide=function(e){var t=this;return e||(e=function(){t.dismiss()}),a.getIcon("spinner-circle-dark",a.sizes.large,null,null).done(function(s){var r=i("<div />",{class:"text-center"}).append(s);t.addSlide("final-processing-slide",top.TYPO3.lang["wizard.processing.title"],r[0].outerHTML,n.info,e)})},e.prototype.show=function(){var e=this,t=this.generateSlides(),s=this.setup.slides[0];r.confirm(s.title,t,s.severity,[{text:top.TYPO3.lang["wizard.button.cancel"],active:!0,btnClass:"btn-default",name:"cancel",trigger:function(){e.getComponent().trigger("wizard-dismiss")}},{text:top.TYPO3.lang["wizard.button.next"],btnClass:"btn-"+n.getCssClass(s.severity),name:"next"}]),this.setup.forceSelection&&this.lockNextStep(),this.addProgressBar(),this.initializeEvents(),this.getComponent().on("wizard-visible",function(){e.runSlideCallback(s,e.setup.$carousel.find(".item").first())}).on("wizard-dismissed",function(){e.setup=i.extend(!0,{},e.originalSetup)})},e.prototype.getComponent=function(){return null===this.setup.$carousel&&this.generateSlides(),this.setup.$carousel},e.prototype.dismiss=function(){r.dismiss()},e.prototype.lockNextStep=function(){var e=this.setup.$carousel.closest(".modal").find('button[name="next"]');return e.prop("disabled",!0),e},e.prototype.unlockNextStep=function(){var e=this.setup.$carousel.closest(".modal").find('button[name="next"]');return e.prop("disabled",!1),e},e.prototype.initializeEvents=function(){var e=this,t=this.setup.$carousel.closest(".modal"),s=t.find(".modal-title"),a=t.find(".modal-footer"),o=a.find('button[name="next"]');o.on("click",function(){e.setup.$carousel.carousel("next")}),this.setup.$carousel.on("slide.bs.carousel",function(){var i=e.setup.$carousel.data("currentSlide")+1,r=e.setup.$carousel.data("currentIndex")+1;s.text(e.setup.slides[r].title),e.setup.$carousel.data("currentSlide",i),e.setup.$carousel.data("currentIndex",r),i>=e.setup.$carousel.data("realSlideCount")?(t.find(".modal-header .close").remove(),a.slideUp()):a.find(".progress-bar").width(e.setup.$carousel.data("initialStep")*i+"%").text(top.TYPO3.lang["wizard.progress"].replace("{0}",i).replace("{1}",e.setup.$carousel.data("slideCount"))),o.removeClass("btn-"+n.getCssClass(e.setup.slides[r-1].severity)).addClass("btn-"+n.getCssClass(e.setup.slides[r].severity)),t.removeClass("modal-severity-"+n.getCssClass(e.setup.slides[r-1].severity)).addClass("modal-severity-"+n.getCssClass(e.setup.slides[r].severity))}).on("slid.bs.carousel",function(t){var s=e.setup.$carousel.data("currentIndex"),r=e.setup.slides[s];e.runSlideCallback(r,i(t.relatedTarget)),e.setup.forceSelection&&e.lockNextStep()});var l=this.getComponent();l.on("wizard-dismiss",this.dismiss),r.currentModal.on("hidden.bs.modal",function(){l.trigger("wizard-dismissed")}).on("shown.bs.modal",function(){l.trigger("wizard-visible")})},e.prototype.runSlideCallback=function(e,t){"function"==typeof e.callback&&e.callback(t,this.setup.settings,e.identifier)},e.prototype.addProgressBar=function(){var e,t=this.setup.$carousel.find(".item").length,s=Math.max(1,t),r=this.setup.$carousel.closest(".modal").find(".modal-footer");e=Math.round(100/s),this.setup.$carousel.data("initialStep",e).data("slideCount",s).data("realSlideCount",t).data("currentIndex",0).data("currentSlide",1),s>1&&r.prepend(i("<div />",{class:"progress"}).append(i("<div />",{role:"progressbar",class:"progress-bar","aria-valuemin":0,"aria-valuenow":e,"aria-valuemax":100}).width(e+"%").text(top.TYPO3.lang["wizard.progress"].replace("{0}","1").replace("{1}",s))))},e.prototype.generateSlides=function(){if(null!==this.setup.$carousel)return this.setup.$carousel;for(var e='<div class="carousel slide" data-ride="carousel" data-interval="false"><div class="carousel-inner" role="listbox">',t=0;t<this.setup.slides.length;++t){var s=this.setup.slides[t],r=s.content;"object"==typeof r&&(r=r.html()),e+='<div class="item" data-slide="'+s.identifier+'">'+r+"</div>"}return e+="</div></div>",this.setup.$carousel=i(e),this.setup.$carousel.find(".item").first().addClass("active"),this.setup.$carousel},e}();try{window.opener&&window.opener.TYPO3&&window.opener.TYPO3.Wizard&&(o=window.opener.TYPO3.Wizard),parent&&parent.window.TYPO3&&parent.window.TYPO3.Wizard&&(o=parent.window.TYPO3.Wizard),top&&top.TYPO3&&top.TYPO3.Wizard&&(o=top.TYPO3.Wizard)}catch(e){}return o||(o=new l,"undefined"!=typeof TYPO3&&(TYPO3.Wizard=o)),o});