/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","moment","./Storage/Persistent"],function(a,b,c,d,e){"use strict";var f=function(){function b(){var a=this;this.fieldSelector=".t3js-datetimepicker",this.format=(null!=opener&&"undefined"!=typeof opener.top.TYPO3?opener.top:top).TYPO3.settings.DateTimePicker.DateFormat,c(function(){a.initialize()})}return b.formatDateForHiddenField=function(a,b){return"time"!==b&&"timesec"!==b||a.year(1970).month(0).date(1),a.format()},b.prototype.initialize=function(){var f=this,g=c(this.fieldSelector).filter(function(a,b){return"undefined"==typeof c(b).data("DateTimePicker")});g.length>0&&a(["twbs/bootstrap-datetimepicker"],function(){var a=e.get("lang");"ch"===a&&(a="zh-cn");var h=!!a&&d.locale(a);g.each(function(a,b){f.initializeField(c(b),h)}),g.on("blur",function(a){var e=c(a.currentTarget),f=e.parent().parent().find('input[type="hidden"]');if(""===e.val())f.val("");else{var g=e.data("dateType"),h=e.data("DateTimePicker").format(),i=d.utc(e.val(),h);i.isValid()?f.val(b.formatDateForHiddenField(i,g)):e.val(b.formatDateForHiddenField(d.utc(f.val()),g))}}),g.on("dp.change",function(a){var d=c(a.currentTarget),e=d.parent().parent().find("input[type=hidden]"),g=d.data("dateType"),h="";""!==d.val()&&(h=b.formatDateForHiddenField(a.date.utc(),g)),e.val(h),c(document).trigger("formengine.dp.change",[c(f)])})})},b.prototype.initializeField=function(a,b){var c=this.format,e=a.data("dateType"),f={format:"",locale:"",sideBySide:!0,showTodayButton:!0,toolbarPlacement:"bottom",icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-calendar-o",clear:"fa fa-trash"}};switch(e){case"datetime":f.format=c[1];break;case"date":f.format=c[0];break;case"time":f.format="HH:mm";break;case"timesec":f.format="HH:mm:ss";break;case"year":f.format="YYYY"}a.data("dateMindate")&&a.data("dateMindate",d.unix(a.data("dateMindate")).format(f.format)),a.data("dateMaxdate")&&a.data("dateMaxdate",d.unix(a.data("dateMaxdate")).format(f.format)),b&&(f.locale=b),a.datetimepicker(f)},b}();return new f});